{% extends "base.j2" %}

{% block title %}Sign Up - TubeSync{% endblock %}

{% block js_head %}
{{ super() }}
<script type='text/javascript' src='/static/js/jquery.validate.min.js'></script>

<script type='text/javascript' src='/static/js/ajaxerrors.js'></script>
{% endblock %}

{% block content %}

<div class="row">
	<div class="span12">
		<form id="signup-form">
			<fieldset>
				<legend>Create an account</legend>

				<label for="username">Username</label>
				<input id="username" type="text" placeholder="Username" required>
				<!-- <span class="help-block">Your username must </span> -->

				<label for="email">Email address</label>
				<input id="email" name="email" type="email" placeholder="your@email.com" required>
				<span class="help-block">We will <b>never</b> give out your email address. We will only use it to send you important notifications about your account (not annoying spam) and to verify your account so we can make sure you're not an evil robot from the future.</span>

				<label for="password">Password</label>
				<input id="password" name="password"  type="password" placeholder="Password" required>
				<input id="repeatpwd" name="repeatpwd" type="password" placeholder="Repeat password" maxlength="32" required>
				<!-- <span class="help-block">Your password must be 6-32 characters long. We recommend using uppercase letters, lowercase letters, numbers, and symbols, but if you don't want to, that's fine. Just don't come crying when your password gets cracked.</span> -->

				<br />
				<button id="submitbtn" type="submit" class="btn btn-primary">Submit</button>
			</fieldset>
		</form>
	</div>
</div>

{% endblock %}


{% block js_body %}
<script type="text/javascript">

$(document).ready(function()
{
	var validator = $("#signup-form").validate({
		rules: {
			username: {
				required: true,
				minlength: 2,
				maxlength: 80,
			},
			email: {
				required: true,
				email: true,
				maxlength: 320,
			},
			password: {
				required: true,
				minlength: 6,
			},
			repeatpwd: {
				required: true,
				minlength: 6,
				equalTo: "#password",
			},
		},

		messages: {
			username: {
				required: "You must enter a username.",
				minlength: jQuery.format("Your username must be at least {0} characters long."),
				remote: jQuery.format("The username {0} is already taken."),
			},
			password: {
				required: "You must enter a password.",
				minlength: jQuery.format("Your password must be at least {0} characters long."),
			},
			repeatpwd: {
				required: "Passwords must match.",
				minlength: "Passwords must match.",
				equalTo: "Passwords must match."
			},
		},

		// errorPlacement: function(error, element)
		// {
		// 	if (element.is(""))
		// },

		submitHandler: function(form)
		{
			$.ajax({
				type: "POST",
				url: "/signup/ajax",
				data: $.param({
					username: $("#username").val(),
					password: $("#password").val(),
					email:    $("#email").val(),
				}),
				dataType: "json",

				success: function(data, textStatus)
				{
					if (data.success)
					{
						
					}
					else
					{
						// The server gave us an error.
						switch (data.error_id)
						{
						case "name_taken":
							alert("That username is already taken.");
							break;

						default:
							alert(data.error_msg);
							break;
						}
					}
				},

				error: function(jqXHR, jqError, httpError)
				{
					var errorMsg = "An unknown error occurred.";

					if (Math.floor(jqXHR.status / (Math.pow(10, 2)) % 10) !== 2)
					{
						errorMsg = getHTTPErrorMsg(jqXHR.status);
					}
					else
					{
						errorMsg = getJQErrorMsg(jqError);
					}

					alert(errorMsg);
				},
			});
		},
	});
});

</script>
{% endblock %}
